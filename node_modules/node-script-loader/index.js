/***

 This is the basic framework, which will be built upon. We basically take a directory as an 
 argument, then a callback function as an argument, and iteratively load each file in that 
 directory into the callback.
 
 ***/

// require file system
var fs = require("fs");

// require path
var path = require("path");

String.isNullOrEmpty = function (value) {
    return !value;
}


// loader function takes directory and a callback
var fetcher = function(dir, callback) {
    
    // set the app root so we can use relative path in our loader call
    var appRoot = process.cwd();
    
    // load the directory 
    var loadPath = path.join(appRoot, dir);
        
    var appRoot = process.cwd();
    
    var loadPath = path.join(appRoot, dir);
    
    fs.readdirSync(loadPath).forEach(function(file) { 
    
        callback(file, loadPath);
    
    });        

};


var loader = function(dir, isExecute, isGlobal, objName) {
    
    fetcher(dir, function(file, loadPath) {

        // break the .js extension off 
        moduleName = file.split(".");

        if (isExecute) {
            console.log("Running: " + loadPath + "/" + file);
            var script = require(loadPath + "/" + file); 
            typeof script === 'function' && script();
        }        
        else {
            if (isGlobal) {
                if (moduleName[0] == "index") {
                    console.log("Loading Global Index: " + loadPath + "/");
                    global[dir] = require(loadPath + "/");
                    console.log(global[dir]);
                }
                else {
                    console.log("Loading Global: " + loadPath + "/" + file);
                    global[dir][moduleName[0]] = require(loadPath + "/" + file);  
                    console.log(global[dir]);
                }
            }
            else { 
                if (moduleName[0] == "index") {
                    console.log("Loading Index: "+ loadPath + "/");          
                    global[dir] = require(loadPath + "/");     
                    console.log(global[dir]);                    
                }
                else {
                    console.log("Loading: " + loadPath + "/" + file);
                    global[moduleName[0]] = require(loadPath + "/" + file);  
                    console.log(moduleName[0]);
                }
            }
        }
        
    });
    
};


module.exports = loader;